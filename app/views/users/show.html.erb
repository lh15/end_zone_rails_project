<a href="/events">View Events</a><br>
<h1> Hi <%= @user.first_name %> </h1>


<div id="info">
    <h3>Basic Info</h3>
    <p> Full Name: <%= @user.first_name %> <%= @user.last_name %> </p>
    <p> Address: <%= @user.address %> </p>
    <p> Phone: <%= @user.phone_number %> </p>
    <p> E-Mail: <%= @user.email %> </p>
</div>
<a href="/users/<%= @user.id %>/edit">Edit your profile</a>

<div id="purchases">
    <h3>Purchase History</h3>
    <ul style="list-style:none">
    <% if !!@purchases %>

    <% @purchases.group_by(&:event).each do |purchase| %>
        <% purchase.inspect %>
        <% purchase.each do |ticket| %>
            <% sum = 0 %>
            <% if ticket == purchase[0] %>
                <h5><%= ticket.title %><br>
                <%= ticket.date.strftime("%m/%d/%y") %><br>
                <%= ticket.venue.name %></h5>
            <% else %>
                <% ticket.each do |ticket_each| %>
                    <li>
                        <% if ticket_each == ticket[0] %>
                            (Purchased on <%= ticket_each.date_purchased.strftime("%m/%d/%y") %>)<br>
                        <% end %>
                    Seat: <%= ticket_each.seat_number %><%= ticket_each.section %>  |  
                    Price: $<%= '%.2f' % ticket_each.price %>
                    <% sum += ticket_each.price %>
                    </li>
                <% end %>

                Total: $<%= '%.2f' % sum %>
            <% end %>       
        <% end %>    

        <br>
    <% end %>  
    </ul>  
    <% else %>
        <p>No purchases yet!</p>
    <% end %>
</div>

<div id="listings">
    <h3>My Listings</h3>
    <ul style="list-style:none">
    <% if !!@listings %>
    <% @listings.each do |listing| %>
        <li>
            <%= listing.event.title %><br>
            <%= listing.event.date.strftime("%m/%d/%y") %><br>
            <%= listing.event.venue.name %><br>
            <% if listing.sold == true %>
                Status: sold (on <%= listing.date_purchased.strftime("%m/%d/%y") %>)
            <% else %>
                Status: for sale<br>
                <a href='/tickets/<%= listing.id %>/edit'>Edit this listing</a><br>
            <% end %>       
        </li><br>  
    <% end %>  
    </ul>  
    <% else %>
        <p>No tickets for sale yet!</p>
    <% end %>
</div>



